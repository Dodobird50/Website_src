var _=window._;(function(){var baseMinWidth;var timestamp;function init(){body=document.getElementsByTagName("body")[0];_.isMobile=false;_.finishedSetup=false;try{var indexOfLeftBrace=document.cookie.indexOf("{");var indexOfRightBrace=document.cookie.indexOf("}");_.userSettings=JSON.parse(document.cookie.substring(indexOfLeftBrace,indexOfRightBrace+1));var isValid=Math.abs(_.userSettings.sortingMethod)<=5;if(!isValid){throw new Error}var validLanguages=["en-US","es-ES","zh-CN","fr-FR","ja-JP"];isValid=false;for(var i=0;i<5;i++){if(_.userSettings.language==validLanguages[i]){isValid=true;break}}if(!isValid){throw new Error}isValid=false;if(_.userSettings.pinnedState){for(var i=0;i<55;i++){if(_.userSettings.pinnedState==stateAbbreviations[i]){isValid=true;break}}}else{isValid=true}if(!isValid){throw new Error}}catch(error){_.userSettings={};_.userSettings.language="en-US";_.userSettings.indicateUpdatedStates=false;_.userSettings.isNightMode=false;_.userSettings.hideLanguageDiv=false;_.userSettings.sortingMethod=0;_.userSettings.pinnedState=null}_.setTitle();if(_.userSettings.isNightMode){document.getElementsByTagName("body")[0].style.backgroundColor="black"}select0.value=_.userSettings.language;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)){_.isMobile=true}if(navigator.userAgent.indexOf("Win")!=-1){body.style.fontFamily="Calibri"}var resizeTimeout;var resize=function(){if(_.finishedSetup&&_.bodyWidth!=body.offsetWidth){_.bodyWidth=body.offsetWidth;readjustSizes();resizeTimeout=null}};window.onresize=function(){if(resizeTimeout!=null){clearTimeout(resizeTimeout)}resizeTimeout=setTimeout(resize,250)};var checkForUpdates=function(){if(!_.finishedSetup){return}$.get("../data/last-updated.txt",function(responseText){var newTimestamp=parseInt(responseText);if(newTimestamp>timestamp){$.get("../data/data.json",function(data){data=JSON.parse(data);var newAllData=data.data;if(newAllData[newAllData.length-1].t<=_.allData[_.allData.length-1].t){return}setTimeout(function(){_.updateTimeTravelMax(newAllData);processData(data);_.setLastUpdatedOnText();_.refreshDataDisplay();_.loadColB();for(var i=0;i<_.charts.length;i++){var state=_.charts[i].state;var checked=i%2==1&&_.charts[i].checkbox.checked;_.makeChart(_.charts[i],state,true);if(checked){_.charts[i].checkbox.checked=true;_.charts[i].checkbox.onclick()}}timestamp=_.allData[_.allData.length-1].t;var scrollTop=html.scrollTop;var updateAlreadyVisible=true;if(updateDiv.className=="d-none"){updateDiv.className="";updateAlreadyVisible=false;_.setDismissUpdateButtonInnerHTML()}_.setUpdateNotificationInnerHTML();var w=_.baseWidth;var fontSize;if(_.isUSMapVisible){fontSize=.01*w}else{fontSize=.02*w}updateNotification.style.fontSize=1.3*fontSize+"px";dismissUpdateButton.style.fontSize=1.1*fontSize+"px";dismissUpdateButton.style.borderWidth=fontSize/12+"px";dismissUpdateButton.style.height=updateNotification.offsetHeight+"px";var combinedWidth=updateNotification.offsetWidth+dismissUpdateButton.offsetWidth;var updateNotificationLeft=(.97*w-combinedWidth)/2;updateNotification.style.left=updateNotificationLeft+"px";dismissUpdateButton.style.right=updateNotificationLeft+"px";updateDiv.style.height=updateNotification.offsetHeight+"px";updateDiv.style.marginBottom=.015*w+"px";if(!updateAlreadyVisible){window.scrollTo(0,scrollTop+parseFloat(updateDiv.style.height)+.015*w)}},1)},"text")}})};setInterval(checkForUpdates,1e4);dismissUpdateButton.onclick=function(){updateDiv.className="d-none"};_.setConfirmLanguageButtonInnerHTML();if(_.userSettings.hideLanguageDiv){languageDiv.className="d-none"}_.setToggleNightModeButtonInnerHTML();for(var i=0;i<_.states.length;i++){var state=_.states[i];var stateAbbreviation=_.stateAbbreviations[i];var option=document.createElement("option");option.innerHTML=_.translateState(state);option.setAttribute("value",stateAbbreviation);select2.appendChild(option)}$.ajaxSetup({cache:false});$.get("../data/data.json",function(data){var dataFromJSON=JSON.parse(data);processData(dataFromJSON);_.initTimeTravel();_.setLastUpdatedOnText();timestamp=_.allData[_.allData.length-1].t;_.dataDisplayHeaderHTML=_.dataDisplayHeaderHTMLs[_.languageIndex()];_.refreshDataDisplay();$.get("../data/state-circle-data.txt",function(responseText){stateCircleData=responseText;_.setResetChartsButtonInnerHTML();_.setIndicateUpdatedStatesCheckboxLabelInnerHTML();if(_.userSettings.indicateUpdatedStates){indicateUpdatedStatesCheckbox.checked=true}indicateUpdatedStatesCheckbox.onclick=_.toggleIndicateUpdatedStates;_.charts=[totalCasesChart,newCasesChart,totalCasesPer100000PeopleChart,newCasesPer100000PeopleChart,totalDeathsChart,newDeathsChart];for(var i=0;i<_.charts.length;i++){_.charts[i].dateRange=0}base.className="container-fluid";body.style.overflowY="scroll";_.bodyWidth=body.offsetWidth;baseMinWidth=.9*_.bodyWidth;if(!_.isMobile){baseMinWidth=Math.max(baseMinWidth,975);colA.className="col-6";colB.className="col-6"}else{baseMinWidth=0}_.isUSMapVisible=getComputedStyle(colB).display!="none";readjustSizes();if(_.userSettings.isNightMode){_.userSettings.isNightMode=false;toggleNightModeButton.click()}_.finishedSetup=true})},"text")}function processData(allDataFromJSON){_.allData=allDataFromJSON.data;if(_.userSettings.dataFromTodayIndex==undefined){_.userSettings.dataFromTodayIndex=-1}for(var i=0;i<_.allData.length;i++){var data=_.allData[i];data.getEntry=function(state){var self=this;var entries=self.e;for(var j=0;j<entries.length;j++){if(entries[j][0]==state){return entries[j]}}return null}}if(_.userSettings.dataFromTodayIndex>=0){_.dataFromToday=_.allData[_.userSettings.dataFromTodayIndex];_.dataFromYesterday=_.allData[_.userSettings.dataFromTodayIndex-1]}else{_.dataFromToday=_.allData[_.allData.length-1];_.dataFromYesterday=_.allData[_.allData.length-2]}_.entriesFromToday=_.dataFromToday.e;_.calendarFromToday=_.dataFromToday.d;_.entriesFromYesterday=_.dataFromYesterday.e;_.calendarFromYesterday=_.dataFromYesterday.d;_.casesDataAnomalies=allDataFromJSON.cases_data_anomalies;_.deathsDataAnomalies=allDataFromJSON.deaths_data_anomalies;for(var key in _.casesDataAnomalies){_.casesDataAnomalies[key]=new Set(_.casesDataAnomalies[key])}for(var key in _.deathsDataAnomalies){_.deathsDataAnomalies[key]=new Set(_.deathsDataAnomalies[key])}if(_.userSettings.sortingMethod==0){if(_.sevenDayAverageInNewCasesPer100000People()>=10){_.userSettings.sortingMethod=5}else{_.userSettings.sortingMethod=2}_.updateCookies()}_.sortEntries()}function readjustSizes(){if(_.bodyWidth>baseMinWidth){base.style.width=_.bodyWidth-1+"px";_.baseWidth=_.bodyWidth-1}else{base.style.width=baseMinWidth+"px";_.baseWidth=baseMinWidth}var w=_.baseWidth;if(_.isMobile){if(w>=975){colA.className="col-6";colB.className="col-6";_.isUSMapVisible=true}else{colA.className="";colB.className="d-none";_.isUSMapVisible=false}}base.style.padding=.015*w+"px";var fontSize;if(_.isUSMapVisible){fontSize=.01*w}else{fontSize=.02*w}if(updateDiv.className==""){updateNotification.style.fontSize=1.3*fontSize+"px";dismissUpdateButton.style.fontSize=1.1*fontSize+"px";dismissUpdateButton.style.borderWidth=fontSize/12+"px";dismissUpdateButton.style.height=updateNotification.offsetHeight+"px";var combinedWidth=updateNotification.offsetWidth+dismissUpdateButton.offsetWidth;var updateNotificationLeft=(.97*w-combinedWidth)/2;updateNotification.style.left=updateNotificationLeft+"px";dismissUpdateButton.style.right=updateNotificationLeft+"px";updateDiv.style.height=updateNotification.offsetHeight+"px";updateDiv.style.marginBottom=.015*w+"px"}if(languageDiv.className!="d-none"){var tempFontSize=1.1*fontSize;select0.style.fontSize=1.1*tempFontSize+"px";confirmLanguageButton.style.fontSize=tempFontSize+"px";confirmLanguageButton.style.height=select0.offsetHeight+"px";confirmLanguageButton.style.borderWidth=tempFontSize/12+"px";if(_.isUSMapVisible){confirmLanguageButton.style.width="";select0.style.width="";select0.style.right=""}else{confirmLanguageButton.style.width="36%";select0.style.right="40%";select0.style.width="36%"}languageDiv.style.height=select0.offsetHeight+"px";languageDiv.style.marginBottom=.015*w+"px"}toggleNightModeButton.style.fontSize=fontSize+"px";toggleNightModeButton.style.borderWidth=fontSize/12+"px";rowA0.style.height=toggleNightModeButton.offsetHeight+"px";rowA1.style.borderWidth=fontSize/12+"px";readjustDataDisplayTextFonts();var colAWidth;if(_.isUSMapVisible){colAWidth=.485*_.baseWidth}else{colAWidth=.97*_.baseWidth}readjustRowA2TextFonts();_.loadColB();if(_.isUSMapVisible){indicateUpdatedStatesCheckbox.style.width=.014*w+"px";indicateUpdatedStatesCheckbox.style.height=.014*w+"px";indicateUpdatedStatesCheckbox.style.marginRight=.003*w+"px";indicateUpdatedStatesCheckboxLabel.style.lineHeight=.014*w+"px";indicateUpdatedStatesCheckboxLabel.style.fontSize=.01*w+"px";rowB1.style.height=.014*w+"px"}var rowA1Height;if(_.isUSMapVisible){rowA1Height=.35625*w-parseFloat(rowA0.style.height)-rowA2.offsetHeight-.025*colAWidth}else{rowA1Height=rowA1.offsetWidth*.5}rowA1.style.height=rowA1Height+"px";row1.height=row1.offsetHeight;select2.style.fontSize=1.1*fontSize+"px";resetChartsButton.style.fontSize=fontSize+"px";resetChartsButton.style.borderWidth=fontSize/12+"px";select2.style.height=resetChartsButton.offsetHeight+"px";chartControlDiv.style.height=select2.style.height;if(_.isUSMapVisible){select2.style.width="";select2.style.left="";resetChartsButton.style.width="";resetChartsButton.style.right=""}else{select2.style.width="40%";select2.style.left="6.67%";resetChartsButton.style.width="40%";resetChartsButton.style.right="6.67%"}if(_.finishedSetup){for(var i=0;i<_.charts.length;i++){var checked=i%2==1&&_.charts[i].checkbox.checked;checkboxLabelWidth=null;_.makeChart(_.charts[i],_.charts[i].state,false);if(checked){_.charts[i].checkbox.checked=true;_.charts[i].checkbox.onclick()}}}else{for(var i=0;i<_.charts.length;i++){checkboxLabelWidth=null;_.makeChart(_.charts[i],"USA",false)}}timeTravelDiv.style.borderWidth=_.charts[0].style.borderWidth;timeTravelDiv.style.bottom=base.style.paddingBottom;if(!_.isMobile&&_.isTimeTravelActive()){timeTravelDiv.style.width=.97*_.baseWidth+"px";var left=parseFloat(base.style.paddingLeft)-window.pageXOffset;timeTravelDiv.style.left=left+"px"}timeTravelRangeLabel.style.fontSize=1.6*fontSize+"px";timeTravelDivFiller.style.height=timeTravelDiv.offsetHeight+"px"}function readjustDataDisplayTextFonts(){var w=dataDisplay.offsetWidth;dataDisplay.style.fontSize=w/55+"px"}function readjustRowA2TextFonts(){var w=_.baseWidth;var fontSizes;if(_.isUSMapVisible){fontSizes=[w/60,w/100,w/100,w/100,w/100,w/100,w/140]}else{fontSizes=[w/30,w/50,w/50,w/50,w/50,w/50,w/70]}var padding=w/800+"px";for(var i=0;i<rowA2.children.length;i++){var div=rowA2.children[i];div.style.fontSize=fontSizes[i]+"px";div.style.paddingBottom=padding;if(i==0){div.style.fontWeight="bold"}}}$(document).ready(function(){init()})})();